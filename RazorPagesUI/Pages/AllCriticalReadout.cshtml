@page
@model RazorPagesUI.Pages.AllCriticalReadoutModel
@{
}
<div class="container">

    <div class="row align-items-center">
        <div class="col-md-5 align-self-center">
            <form method="post" asp-page-handler="Search" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="@Model.DetailDisplayState" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                <div class="row">
                    <h1 class="text-center">CRITICAL ITEMS</h1>
                </div>
                <div class="row">
                    <div class="input-group mb-3">

                        <input type="text" asp-for="@Model.SearchItem" aria-label="Search Lawson#" placeholder="Search item# or keyword" aria-describedby="button-addon2">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="submit" id="button-addon2">Search</button>
                        </div>
                    </div>
                </div>
            </form>
            <form method="post" asp-page-handler="ViewAllItems" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="0" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="0">
                <button type="submit" class="btn btn-outline-secondary">VIEW ALL ITEMS</button>   
            </form>
        </div>

        <div class="col-md-4"></div>
        <div class="col-md-3">
        </div>
    </div>


</div>

<hr class="my-4">
<div class="row">
   
</div>
<div class="row">
    <div class="col-md-6">
        <div class="row">
            <div class="col-md-10">
                <div class="row">
                    <div class="col-md-5">
                        <p>LAWSON#</p>
                    </div>
                    <div class="col-md-7">
                        <a>@Model.BackOrderDisplay.Item</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <p>DESCRIPTION</p>
                    </div>
                    <div class="col-md-7">
                        <a>@Model.BackOrderDisplay.Description</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <p>MFR#</p>
                    </div>
                    <div class="col-md-7">
                        <a>@Model.BackOrderDisplay.MfrNum</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <p>STOCKOUT DATE</p>
                    </div>
                    <div class="col-md-7">
                        <a>@Model.BackOrderDisplay.StockOutDate</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <p>RELEASE DATE</p>
                    </div>
                    <div class="col-md-7">
                        <a>@Model.BackOrderDisplay.ReleaseDate</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <p>GAP DAYS</p>
                    </div>
                    <div class="col-md-7">
                        <a>@Model.BackOrderDisplay.GapDays</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <p>REASON CODE</p>
                    </div>
                    <div class="col-md-7">
                        <a>@Model.BackOrderDisplay.ReasonCode</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <p>STOCK STATUS</p>
                    </div>
                    <div class="col-md-7">
                        <a>@Model.BackOrderDisplay.StockStatus</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <p>SOURCE</p>
                    </div>
                    <div class="col-md-7">
                        <a>@Model.BackOrderDisplay.Source</a>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="col-md-6">
        @{
            if (Model.DetailDisplayState == 0)
            {
                <div class="row">
                    <form method="post" asp-page-handler="DetailChange" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="0" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                        <button type="submit" class="btn btn-dark">
                            NOTES
                        </button>
                    </form>
                    <form method="post" asp-page-handler="DetailChange" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="1" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                        <button type="submit" class="btn btn-outline-secondary">
                            SUBS
                        </button>
                    </form>
                    <form method="post" asp-page-handler="DetailChange" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="2" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                        <button type="submit" class="btn btn-outline-secondary">
                            SITES
                        </button>
                    </form>
                </div>
            }
            else if (Model.DetailDisplayState == 1)
            {
                <div class="row">
                    <form method="post" asp-page-handler="DetailChange" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="0" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                        <button type="submit" class="btn btn-outline-secondary">
                            NOTES
                        </button>
                    </form>
                    <form method="post" asp-page-handler="DetailChange" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="1" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                        <button type="submit" class="btn btn-dark">
                            SUBS
                        </button>
                    </form>
                    <form method="post" asp-page-handler="DetailChange" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="2" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                        <button type="submit" class="btn btn-outline-secondary">
                            SITES
                        </button>
                    </form>
                </div>
            }
            else if (Model.DetailDisplayState == 2)
            {
                <div class="row">
                    <form method="post" asp-page-handler="DetailChange" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="0" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                        <button type="submit" class="btn btn-outline-secondary">
                            NOTES
                        </button>
                    </form>
                    <form method="post" asp-page-handler="DetailChange" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="1" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                        <button type="submit" class="btn btn-outline-secondary">
                            SUBS
                        </button>
                    </form>
                    <form method="post" asp-page-handler="DetailChange" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="2" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                        <button type="submit" class="btn btn-dark">
                            SITES
                        </button>
                    </form>
                </div>
            }
        }

        <div class="row">


            @{

                if (Model.DetailDisplayState == 0)
                {

                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th scope="col">DATE</th>
                                        <th scope="col">USER</th>
                                        <th scope="col">NOTES</th>

                                    </tr>
                                </thead>
                                <tbody>

                                    @{if (!string.IsNullOrWhiteSpace(Model.NotesList[0].ITEM))


                                        {
                                            foreach (var note in Model.DisplayNotesList)


                                            {
                                                int captionLength;
                                                string caption;
                                                string userName;
                                                string dateTrimmed;

                                                userName = Model.GetUserName(note.UserId);

                                                dateTrimmed = note.DATE_CREATED.Remove(11, 8);

                                                captionLength = @Model.GetCaptionLength(note.NOTE);
                                                caption = note.NOTE.Substring(0, captionLength);



                                                <form method="post" asp-page-handler="GetNote" asp-route-ItemId="@Model.ItemId" asp-route-ViewNoteId="@note.Id" asp-route-SiteName="@Model.SiteName" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="@Model.DetailDisplayState">
                                                    <tr>
                                                        <td>

                                                            <button type="submit" class="btn btn-default">
                                                                @dateTrimmed
                                                            </button>
                                                        </td>
                                                        <td>

                                                            <button type="submit" class="btn btn-default">
                                                                @userName
                                                            </button>
                                                        </td>
                                                        <td>
                                                            <button type="submit" class="btn btn-default">
                                                                @caption...
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </form>


                                            }
                                        }
                                    }
                                    <tr></tr>
                                </tbody>
                            </table>

                                        }
                                        else if (Model.DetailDisplayState == 1)
                                        {
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th scope="col">LAWSON#</th>
                                <th scope="col">MFR#</th>
                                <th scope="col">NOTES</th>
                            </tr>
                        </thead>
                        <tbody>

                            @{
                                foreach (var sub in Model.SubsList)
                                {
                                    <tr>
                                        <td>
                                            @sub.Sub_Lawson
                                        </td>
                                        <td>
                                            @sub.Sub_Mfr
                                        </td>
                                        <td>
                                            @sub.Notes
                                        </td>
                                    </tr>
                                }
                            }
                            <tr></tr>
                        </tbody>
                    </table>

                                }
                                else if (Model.DetailDisplayState == 2)
                                {
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th scope="col">LOCATIONS</th>

                            </tr>
                        </thead>
                        <tbody>

                            @{
                                foreach (var site in Model.LocationsList)
                                {
                                    <tr>
                                        <td>
                                            @site
                                        </td>
                                    </tr>
                                }
                            }
                            <tr></tr>
                        </tbody>
                    </table>

                                }
                                else if (Model.DetailDisplayState == 3)
                                {
                                    <form method="post" asp-page-handler="AddNote" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="0" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId ="@Model.MasterSiteUserId">
                                        <div class="form-group">
                                            <label for="newNoteInput">NEW NOTE</label>
                                            <textarea class="form-control rounded-0" id="newNoteInput" rows="10" asp-for="@Model.NewNote"></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-outline-secondary">ADD NOTE</button>
                                    </form>

                                }

            }

        </div>
        
    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <div class="row">

           
        </div>
    </div>

    <div class="col-md-6">
        <div class="row">
            @{ if (Model.DetailDisplayState == 0)
                            {

                <form method="post" asp-page-handler="DetailChange" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="3" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems">
                    <button type="submit" class="btn btn-outline-secondary">NEW NOTE</button>
                </form> if (Model.HasNotes)
                                {
                <form method="post" asp-page-handler="AllNotes" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="0" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems" asp-route-MasterSiteUserId="@Model.MasterSiteUserId">
                    <button type="submit" class="btn btn-outline-secondary">ALL NOTES</button>
                </form> }
                            }
                            else if (Model.DetailDisplayState == 1 && Model.UserCanEditSubs)
                            {
                <form method="post" asp-page-handler="AddSub" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="3" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems">
                    <button type="submit" class="btn btn-outline-secondary">Add Sub</button>
                </form>

                                <form method="post" asp-page-handler="EditSubs" asp-route-ItemId="@Model.ItemId" asp-route-SiteName="@Model.SiteName" asp-route-DisplayState="@Model.DisplayState" asp-route-DetailDisplayState="3" asp-route-HasAccess="@Model.HasAccess" asp-route-UserId="@Model.UserId" asp-route-FromMyItems="@Model.FromMyItems">
                                    <button type="submit" class="btn btn-outline-secondary">Remove Subs</button>
                                </form> 
                            } 
                }
        </div>

    </div>
</div>